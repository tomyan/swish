if(!this.soda){(function(h){var b=h.soda={verison:0.3},i=null,c=[],g=b.scriptElements={},q=[],f={},n=h.document?h.document.getElementsByTagName("head")[0]:false,a=b.ontimeout=function(s,r){if(console&&console.log){console.log("Soda: loading module "+s+" timed out (url: '"+r+"')")}},m=b.timeout=20,p=(h.GLOBAL==h),e="",k,j=function(s,u,t){var r;this.name=s;this.code=t;this.ran=false;this.dependencies=(typeof(u)=="array"||u instanceof Array)?u:[u];if(this.name){f[this.name]=this;r=g[this.name];if(r){h.clearTimeout(r[1]);n.removeChild(r[0]);delete g[this.name]}}if(this.dependencies.length==0){this.run()}else{q.push(this);this.loadDependencies()}};b.GLOBAL=h;function l(){var t=__filename.split(/[\\\/]/),v=process.cwd().split(/[\\\/]/),s="",w=false,u=0,r=t.length-2;t.pop();t.shift();v.shift();for(;u<r;u++){if(w){s+="../"}else{if(v[u]!=t[u]){w=true;u--}}}return s}if(p){e=l();k=process.cwd()}j.prototype.run=function(){if(this.name){this.ran=true;if(!(this.namespace=this.code.apply(h,this.dependencies))){throw new Error('module "'+this.name+'" did not return a namespace object')}this.processPendingDependents()}else{this.code.apply(h,this.dependencies)}};j.prototype.processPendingDependents=function(){var w=[],v,u=0,r=q.length,s,t;for(;u<r;u++){v=true;s=0;t=q[u].dependencies.length;for(;s<t;s++){if(q[u].dependencies[s]==this.name){q[u].dependencies[s]=this.namespace}else{if(typeof(q[u].dependencies[s])=="string"){v=false}}}if(v){w.push(q[u]);q.splice(u--,1);r--}}for(u=0,r=w.length;u<r;u++){w[u].run()}};j.prototype.loadNodeDependency=function(r){if(!p){throw new Error("can only load node modules when running in node.js")}var s=f["node:"+r]={name:"node:"+r,namespace:s,ran:false,dependencies:[]};require.async(r).addCallback(function(t){s.ran=true;s.namespace=t;j.prototype.processPendingDependents.call(s)})};function d(r,s){return function(){throw new Error('could not load module "'+r+'" from path "'+s+'"')}}j.prototype.loadDependencies=function(){var r,v,t,u,w,s,x,z,y,A=true;for(v=0,t=this.dependencies.length;v<t;v++){s=this.dependencies[v];if(typeof(s)!="string"){continue}if(s in f&&f[s].ran){this.dependencies[v]=f[s].namespace;continue}A=false;if(f[s]||g[s]){continue}if(s.substr(0,5)=="node:"){this.loadNodeDependency(s.substr(5));continue}y=0;for(u=0,w=c.length;u<w;u++){if(c[u][0].test(s)&&c[u][2]>y){x=c[u][1];y=c[u][2]}}if(!x){throw new Error("soda.load: no lib configured for '"+s+"'")}r=x+"/"+String(s).replace(/_/g,"/")+".js";if(h.document&&h.document.createElement&&n){z=document.createElement("script");z.setAttribute("type","text/javascript");z.setAttribute("src",r);z.onerror=function(){console.log("TODO script "+r+" errored")};n.appendChild(z);g[s]=[z,a?h.setTimeout(function(){if(a){a(s,r)}},m*1000):0]}else{if(require&&require.async){r=r.replace(/\.js$/,"");require.async(e+r).addErrback(d(s,e+r))}else{if(h.load){h.load(r)}else{throw new Error("Soda: cannot load, unsupported environment")}}}}if(A){this.run()}};function o(u,t){var s="",r="";while(u.indexOf(t)!=0){r=t.match(/[\\\/](\w+)$/)[1]+"/"+r;t=t.replace(/[\\\/]\w+$/,"")}return(s+r).replace(/\/$/,"")}b.lib=function(r){var s=arguments.length-1,t,u;if(p&&r.indexOf("/")==0){r=o(k,r)}if(s==-1){throw new Error("soda.lib: no urlPrefix passed")}else{if(s==0){if(i){throw new Error("soda.lib: default lib path already set")}i=r}else{for(u=1;u<=s;u++){t=arguments[u];if(!/^\w+(?:_\w+)*$/.test(t)){throw new Error('invalid namespace prefix "'+t+'" passed to soda.lib')}c[c.length]=[new RegExp("^"+t+"(?:_|$)"),r,t.length]}}}};b.module=function(r){new j(r.name,r.depends||[],r.code)};b.load=function(r,s){new j(null,r,s)}})(this.GLOBAL||this)};